<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Discussion</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo; 
    
    
    <span class="title">Discussion</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Discussion
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Discussion</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">MongoMapper::Document, <span class='object_link'><a href="ZooniverseId.html" title="ZooniverseId (module)">ZooniverseId</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">app/models/discussion.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
A list of Comments about a Focus
</p>


  </div>
</div>
<div class="tags">
  
</div>

  
  
  
  
  
  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count_mentions-class_method" title="count_mentions (class method)">+ (Object) <strong>count_mentions</strong>(focus) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Counts the number of Discussions mentioning a Focus.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#featured-class_method" title="featured (class method)">+ (Object) <strong>featured</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Selects featured Discussions.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mentioning-class_method" title="mentioning (class method)">+ (Object) <strong>mentioning</strong>(focus, limit = 10) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Selects Discussions mentioning a Focus.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trending-class_method" title="trending (class method)">+ (Object) <strong>trending</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Selects popular Discussions.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_new_comments-class_method" title="with_new_comments (class method)">+ (Object) <strong>with_new_comments</strong>(*args) </a>
    

    
      (also: recent)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Selects Discussions with new Comments.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#archive_and_destroy_as-instance_method" title="#archive_and_destroy_as (instance method)">- (Object) <strong>archive_and_destroy_as</strong>(destroying_user) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Destroy and Archive this Discussion and all Comments in it.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#asset%3F-instance_method" title="#asset? (instance method)">- (Boolean) <strong>asset?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is an Asset Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#board%3F-instance_method" title="#board? (instance method)">- (Boolean) <strong>board?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is a Board Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collection%3F-instance_method" title="#collection? (instance method)">- (Boolean) <strong>collection?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is an AssetSet Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#conversation%3F-instance_method" title="#conversation? (instance method)">- (Boolean) <strong>conversation?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is a Focus conversation.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count_new_comments-instance_method" title="#count_new_comments (instance method)">- (Object) <strong>count_new_comments</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Count the number of new Comments for this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#focus-instance_method" title="#focus (instance method)">- (Object) <strong>focus</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Fetches the Focus of this Discussion if it exists.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#group%3F-instance_method" title="#group? (instance method)">- (Boolean) <strong>group?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is a Group Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#keyword_set%3F-instance_method" title="#keyword_set? (instance method)">- (Boolean) <strong>keyword_set?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is a KeywordSet Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#keywords-instance_method" title="#keywords (instance method)">- (Object) <strong>keywords</strong>(limit = 10) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Selects the Tags for this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent_path-instance_method" title="#parent_path (instance method)">- (Object) <strong>parent_path</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The path to the Focus of this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#path-instance_method" title="#path (instance method)">- (Object) <strong>path</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The path to this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_started_by-instance_method" title="#set_started_by (instance method)">- (Object) <strong>set_started_by</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sets the user that started this discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#started_by-instance_method" title="#started_by (instance method)">- (Object) <strong>started_by</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Finds the User that started this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#started_by%3D-instance_method" title="#started_by= (instance method)">- (Object) <strong>started_by=</strong>(user) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sets the User that started this Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sub_board%3F-instance_method" title="#sub_board? (instance method)">- (Boolean) <strong>sub_board?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
True if this is a SubBoard Discussion.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_embedded_hash-instance_method" title="#to_embedded_hash (instance method)">- (Object) <strong>to_embedded_hash</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Serialize this Discussion to an embedded Hash.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_counts-instance_method" title="#update_counts (instance method)">- (Object) <strong>update_counts</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Updates the denormalized counts.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="count_mentions-class_method">
  
    + (<tt>Object</tt>) <strong>count_mentions</strong>(focus) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Counts the number of Discussions mentioning a Focus
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 67</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id count_mentions'>count_mentions</span><span class='lparen'>(</span><span class='id focus'>focus</span><span class='rparen'>)</span>
  <span class='id comments'>comments</span> <span class='op'>=</span> <span class='const'>Comment</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:mentions</span> <span class='op'>=&gt;</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id only'>only</span><span class='lparen'>(</span><span class='symbol'>:discussion_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id all'>all</span>
  <span class='id comments'>comments</span><span class='period'>.</span><span class='id collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id c'>c</span><span class='op'>|</span> <span class='id c'>c</span><span class='period'>.</span><span class='id discussion_id'>discussion_id</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id length'>length</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="featured-class_method">
  
    + (<tt>Object</tt>) <strong>featured</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Selects featured Discussions
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 36</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id featured'>featured</span>
  <span class='id sort'>sort</span><span class='lparen'>(</span><span class='symbol'>:updated_at</span><span class='period'>.</span><span class='id desc'>desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:featured</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="mentioning-class_method">
  
    + (<tt>Object</tt>) <strong>mentioning</strong>(focus, limit = 10) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Selects Discussions mentioning a Focus
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'></span>
      
      
        <span class='name'>focus</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The focus to find mentions of
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
        <span class='name'>limit</span>
      
      
        <em class="default">(defaults to: <tt>10</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The number of Discussions to find
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 51</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id mentioning'>mentioning</span><span class='lparen'>(</span><span class='id focus'>focus</span><span class='comma'>,</span> <span class='id limit'>limit</span> <span class='op'>=</span> <span class='int'>10</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='const'>Comment</span><span class='period'>.</span><span class='id count'>count</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='id collected'>collected</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id page'>page</span> <span class='op'>=</span> <span class='int'>1</span>
  
  <span class='kw'>begin</span>
    <span class='id comments'>comments</span> <span class='op'>=</span> <span class='const'>Comment</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:mentions</span> <span class='op'>=&gt;</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id only'>only</span><span class='lparen'>(</span><span class='symbol'>:discussion_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id page'>page</span><span class='rparen'>)</span>
    <span class='id comments'>comments</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id comment'>comment</span><span class='op'>|</span> <span class='id collected'>collected</span><span class='lbracket'>[</span><span class='id comment'>comment</span><span class='period'>.</span><span class='id discussion_id'>discussion_id</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='rbrace'>}</span>
    <span class='id comments'>comments</span> <span class='op'>=</span> <span class='id comments'>comments</span><span class='period'>.</span><span class='id next_page'>next_page</span>
  <span class='kw'>end</span> <span class='kw'>while</span><span class='lparen'>(</span><span class='id comments'>comments</span> <span class='op'>&amp;&amp;</span> <span class='id collected'>collected</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>&lt;</span> <span class='id limit'>limit</span><span class='rparen'>)</span>
  
  <span class='id collected'>collected</span> <span class='op'>=</span> <span class='id collected'>collected</span><span class='period'>.</span><span class='id sort'>sort</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='comma'>,</span> <span class='id b'>b</span><span class='op'>|</span> <span class='id b'>b</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;=&gt;</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id count'>count</span><span class='op'>|</span> <span class='id id'>id</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id uniq'>uniq</span>
  <span class='id collected'>collected</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='id limit'>limit</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id map'>map</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id id'>id</span><span class='op'>|</span> <span class='id find'>find</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="trending-class_method">
  
    + (<tt>Object</tt>) <strong>trending</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Selects popular Discussions
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>*args</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a customizable set of options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>*args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:page</span>
          <span class="default">
            
              &mdash; default:
              <tt>1</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The page of Discussions to find
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:per_page</span>
          <span class="default">
            
              &mdash; default:
              <tt>10</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The number of Discussions per page
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 43</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id trending'>trending</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>10</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id update'>update</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span><span class='rparen'>)</span>
  <span class='const'>Discussion</span><span class='period'>.</span><span class='id sort'>sort</span><span class='lparen'>(</span><span class='symbol'>:popularity</span><span class='period'>.</span><span class='id desc'>desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:number_of_comments</span><span class='period'>.</span><span class='id gt'>gt</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id paginate'>paginate</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:per_page</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="with_new_comments-class_method">
  
    + (<tt>Object</tt>) <strong>with_new_comments</strong>(*args) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='recent-class_method'>recent</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Selects Discussions with new Comments
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>*args</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a customizable set of options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>*args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:page</span>
          <span class="default">
            
              &mdash; default:
              <tt>1</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The page of Discussions to find
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:per_page</span>
          <span class="default">
            
              &mdash; default:
              <tt>10</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The number of Discussions per page
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="name">:read_list</span>
          <span class="default">
            
              &mdash; default:
              <tt>[]</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The list of Discussions recently read (for exclusion)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:by_user</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Limit selection to Discussions with Comments by a given User
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:for_user</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The User for which Discussions are being found
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:since</span>
          <span class="default">
            
              &mdash; default:
              <tt>Time.now.utc.beginning_of_day</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Limit selection to Discussions updated since this time
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 79</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id with_new_comments'>with_new_comments</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
           <span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
           <span class='symbol'>:read_list</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
           <span class='symbol'>:for_user</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
           <span class='symbol'>:by_user</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
           <span class='symbol'>:since</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id utc'>utc</span><span class='period'>.</span><span class='id beginning_of_day'>beginning_of_day</span>
         <span class='rbrace'>}</span><span class='period'>.</span><span class='id update'>update</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span><span class='rparen'>)</span>
  
  <span class='id since_time'>since_time</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id last_login_at'>last_login_at</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id last_login_at'>last_login_at</span>
  <span class='id since_time'>since_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id present?'>present?</span>
  <span class='id since_time'>since_time</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id utc'>utc</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span>
  
  <span class='id cursor'>cursor</span> <span class='op'>=</span> <span class='const'>Discussion</span><span class='period'>.</span><span class='id sort'>sort</span><span class='lparen'>(</span><span class='symbol'>:updated_at</span><span class='period'>.</span><span class='id desc'>desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:updated_at</span><span class='period'>.</span><span class='id gte'>gte</span> <span class='op'>=&gt;</span> <span class='id since_time'>since_time</span><span class='comma'>,</span> <span class='symbol'>:number_of_comments</span><span class='period'>.</span><span class='id gt'>gt</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id cursor'>cursor</span> <span class='op'>=</span> <span class='id cursor'>cursor</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:author_ids</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:by_user</span><span class='rbracket'>]</span>
  <span class='id cursor'>cursor</span> <span class='op'>=</span> <span class='id cursor'>cursor</span><span class='period'>.</span><span class='id where'>where</span><span class='lparen'>(</span><span class='symbol'>:_id</span><span class='period'>.</span><span class='id nin'>nin</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:read_list</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:read_list</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id any?'>any?</span>
  <span class='id cursor'>cursor</span><span class='period'>.</span><span class='id paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:per_page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="archive_and_destroy_as-instance_method">
  
    - (<tt>Object</tt>) <strong>archive_and_destroy_as</strong>(destroying_user) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Destroy and Archive this Discussion and all Comments in it
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
        <span class='name'>destroying_user</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The User destroying this Discussion
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177
178
179
180
181
182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 175</span>

<span class='kw'>def</span> <span class='id archive_and_destroy_as'>archive_and_destroy_as</span><span class='lparen'>(</span><span class='id destroying_user'>destroying_user</span><span class='rparen'>)</span>
  <span class='const'>Archive</span><span class='period'>.</span><span class='id create'>create</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Discussion</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:original_id</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id id'>id</span><span class='comma'>,</span>
    <span class='symbol'>:zooniverse_id</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='comma'>,</span>
    <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id started_by_id'>started_by_id</span><span class='comma'>,</span>
    <span class='symbol'>:destroying_user_id</span> <span class='op'>=&gt;</span> <span class='id destroying_user'>destroying_user</span><span class='period'>.</span><span class='id id'>id</span><span class='comma'>,</span>
    <span class='symbol'>:original_document</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id to_embedded_hash'>to_embedded_hash</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
  
  <span class='kw'>self</span><span class='period'>.</span><span class='id destroy'>destroy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="asset?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>asset?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is an Asset Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 119</span>

<span class='kw'>def</span> <span class='id asset?'>asset?</span>
  <span class='id focus_type'>focus_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Asset</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="board?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>board?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is a Board Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 124</span>

<span class='kw'>def</span> <span class='id board?'>board?</span>
  <span class='id focus_base_type'>focus_base_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Board</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="collection?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>collection?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is an AssetSet Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 134</span>

<span class='kw'>def</span> <span class='id collection?'>collection?</span>
  <span class='id focus_type'>focus_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AssetSet</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="conversation?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>conversation?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is a Focus conversation
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 144</span>

<span class='kw'>def</span> <span class='id conversation?'>conversation?</span>
  <span class='lparen'>(</span><span class='id focus_id'>focus_id</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>||</span> <span class='id focus_base_type'>focus_base_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Board</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id conversation'>conversation</span> <span class='op'>==</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="count_new_comments-instance_method">
  
    - (<tt>Object</tt>) <strong>count_new_comments</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Count the number of new Comments for this Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>*args</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a customizable set of options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>*args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:for_user</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The User for which Discussions are being found
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="name">:since</span>
          <span class="default">
            
              &mdash; default:
              <tt>Time.now.utc.beginning_of_day</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Limit selection to Discussions updated since this time
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 105</span>

<span class='kw'>def</span> <span class='id count_new_comments'>count_new_comments</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:since</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id utc'>utc</span><span class='period'>.</span><span class='id beginning_of_day'>beginning_of_day</span><span class='comma'>,</span> <span class='symbol'>:for_user</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id update'>update</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span><span class='rparen'>)</span>
  <span class='id since_time'>since_time</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id last_login_at'>last_login_at</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:for_user</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id last_login_at'>last_login_at</span>
  <span class='id since_time'>since_time</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id utc'>utc</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:since</span><span class='rbracket'>]</span>
  
  <span class='kw'>self</span><span class='period'>.</span><span class='id comments'>comments</span><span class='period'>.</span><span class='id count'>count</span><span class='lparen'>(</span><span class='symbol'>:created_at</span><span class='period'>.</span><span class='id gte'>gte</span> <span class='op'>=&gt;</span> <span class='id since_time'>since_time</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="focus-instance_method">
  
    - (<tt>Object</tt>) <strong>focus</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Fetches the Focus of this Discussion if it exists
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 30</span>

<span class='kw'>def</span> <span class='id focus'>focus</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id focus_id'>focus_id</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>||</span> <span class='id focus_type'>focus_type</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  <span class='ivar'>@cached_focus</span> <span class='op'>||=</span> <span class='id focus_type'>focus_type</span><span class='period'>.</span><span class='id constantize'>constantize</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id focus_id'>focus_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="group?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>group?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is a Group Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 139</span>

<span class='kw'>def</span> <span class='id group?'>group?</span>
  <span class='id focus_type'>focus_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Group</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="keyword_set?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>keyword_set?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is a KeywordSet Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 114</span>

<span class='kw'>def</span> <span class='id keyword_set?'>keyword_set?</span>
  <span class='id focus_type'>focus_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>KeywordSet</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="keywords-instance_method">
  
    - (<tt>Object</tt>) <strong>keywords</strong>(limit = 10) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Selects the Tags for this Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
        <span class='name'>limit</span>
      
      
        <em class="default">(defaults to: <tt>10</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The number of Tags to find
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 162</span>

<span class='kw'>def</span> <span class='id keywords'>keywords</span><span class='lparen'>(</span><span class='id limit'>limit</span> <span class='op'>=</span> <span class='int'>10</span><span class='rparen'>)</span>
  <span class='const'>Tag</span><span class='period'>.</span><span class='id for_discussion'>for_discussion</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id limit'>limit</span><span class='rparen'>)</span><span class='period'>.</span><span class='id collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id t'>t</span><span class='op'>|</span> <span class='id t'>t</span><span class='period'>.</span><span class='id name'>name</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parent_path-instance_method">
  
    - (<tt>Object</tt>) <strong>parent_path</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The path to the Focus of this Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>*args</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a customizable set of options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>*args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="name">*</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Arguments to pass into the url helper
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 242</span>

<span class='kw'>def</span> <span class='id parent_path'>parent_path</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id root_path'>root_path</span> <span class='kw'>unless</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id present?'>present?</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span>
  
  <span class='kw'>case</span> <span class='kw'>self</span><span class='period'>.</span><span class='id focus_base_type'>focus_base_type</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Asset</span><span class='tstring_end'>&quot;</span></span>
    <span class='id object_path'>object_path</span><span class='lparen'>(</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Board</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id path'>path</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AssetSet</span><span class='tstring_end'>&quot;</span></span>
    <span class='id collection_path'>collection_path</span><span class='lparen'>(</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Group</span><span class='tstring_end'>&quot;</span></span>
    <span class='id group_path'>group_path</span><span class='lparen'>(</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="path-instance_method">
  
    - (<tt>Object</tt>) <strong>path</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The path to this Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>*args</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a customizable set of options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>*args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="name">*</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Arguments to pass into the url helper
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


229
230
231
232
233
234
235
236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 229</span>

<span class='kw'>def</span> <span class='id path'>path</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id discussion_path'>discussion_path</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id zooniverse_id'>zooniverse_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id present?'>present?</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span>
  
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id conversation?'>conversation?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id conversation_path'>conversation_path</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id opts'>opts</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id focus'>focus</span><span class='period'>.</span><span class='id discussion_path'>discussion_path</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id opts'>opts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="set_started_by-instance_method">
  
    - (<tt>Object</tt>) <strong>set_started_by</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the user that started this discussion
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 189</span>

<span class='kw'>def</span> <span class='id set_started_by'>set_started_by</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id comments'>comments</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id started_by_id'>started_by_id</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id started_by_id'>started_by_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id comments'>comments</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id author'>author</span><span class='period'>.</span><span class='id id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="started_by-instance_method">
  
    - (<tt>Object</tt>) <strong>started_by</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Finds the User that started this Discussion
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 149</span>

<span class='kw'>def</span> <span class='id started_by'>started_by</span>
  <span class='ivar'>@cached_started_by</span> <span class='op'>||=</span> <span class='const'>User</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id started_by_id'>started_by_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="started_by=-instance_method">
  
    - (<tt>Object</tt>) <strong>started_by=</strong>(user) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the User that started this Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
        <span class='name'>user</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The User that started this Discussion
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 155</span>

<span class='kw'>def</span> <span class='id started_by='>started_by=</span><span class='lparen'>(</span><span class='id user'>user</span><span class='rparen'>)</span>
  <span class='ivar'>@cached_started_by</span> <span class='op'>=</span> <span class='id user'>user</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id started_by_id'>started_by_id</span> <span class='op'>=</span> <span class='id user'>user</span><span class='period'>.</span><span class='id id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sub_board?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>sub_board?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
True if this is a SubBoard Discussion
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 129</span>

<span class='kw'>def</span> <span class='id sub_board?'>sub_board?</span>
  <span class='id focus_type'>focus_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SubBoard</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="to_embedded_hash-instance_method">
  
    - (<tt>Object</tt>) <strong>to_embedded_hash</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Serialize this Discussion to an embedded Hash
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 167</span>

<span class='kw'>def</span> <span class='id to_embedded_hash'>to_embedded_hash</span>
  <span class='id hash'>hash</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id to_mongo'>to_mongo</span>
  <span class='id hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>comments</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id comments'>comments</span><span class='period'>.</span><span class='id collect'>collect</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_embedded_hash</span><span class='rparen'>)</span>
  <span class='id hash'>hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_counts-instance_method">
  
    - (<tt>Object</tt>) <strong>update_counts</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Updates the denormalized counts
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/discussion.rb', line 195</span>

<span class='kw'>def</span> <span class='id update_counts'>update_counts</span>
  <span class='id fresh_comments'>fresh_comments</span> <span class='op'>=</span> <span class='const'>Comment</span><span class='period'>.</span><span class='id collection'>collection</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:discussion_id</span> <span class='op'>=&gt;</span> <span class='id id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_a'>to_a</span>
  
  <span class='id authors'>authors</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id recent_authors'>recent_authors</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id n_recent_comments'>n_recent_comments</span> <span class='op'>=</span> <span class='id n_recent_upvotes'>n_recent_upvotes</span> <span class='op'>=</span> <span class='int'>0</span>
  
  <span class='id fresh_comments'>fresh_comments</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id comment'>comment</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id comment'>comment</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>created_at</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id utc'>utc</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id week'>week</span><span class='period'>.</span><span class='id ago'>ago</span><span class='period'>.</span><span class='id utc'>utc</span>
      <span class='id recent_authors'>recent_authors</span> <span class='op'>&lt;&lt;</span> <span class='id comment'>comment</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>author_id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='id n_recent_comments'>n_recent_comments</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id n_recent_upvotes'>n_recent_upvotes</span> <span class='op'>+=</span> <span class='id comment'>comment</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>upvotes</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id length'>length</span>
    <span class='kw'>end</span>
    
    <span class='id authors'>authors</span> <span class='op'>&lt;&lt;</span> <span class='id comment'>comment</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>author_id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  
  <span class='id new_popularity'>new_popularity</span> <span class='op'>=</span> <span class='id recent_authors'>recent_authors</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>+</span> <span class='id n_recent_comments'>n_recent_comments</span> <span class='op'>+</span> <span class='id n_recent_upvotes'>n_recent_upvotes</span>
  <span class='id authors'>authors</span><span class='period'>.</span><span class='id uniq!'>uniq!</span>
  
  <span class='const'>Discussion</span><span class='period'>.</span><span class='id collection'>collection</span><span class='period'>.</span><span class='id update'>update</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:_id</span> <span class='op'>=&gt;</span> <span class='id id'>id</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>$set</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:number_of_comments</span> <span class='op'>=&gt;</span> <span class='id fresh_comments'>fresh_comments</span><span class='period'>.</span><span class='id length'>length</span><span class='comma'>,</span>
      <span class='symbol'>:number_of_users</span> <span class='op'>=&gt;</span> <span class='id authors'>authors</span><span class='period'>.</span><span class='id length'>length</span><span class='comma'>,</span>
      <span class='symbol'>:popularity</span> <span class='op'>=&gt;</span> <span class='id new_popularity'>new_popularity</span><span class='comma'>,</span>
      <span class='symbol'>:author_ids</span> <span class='op'>=&gt;</span> <span class='id authors'>authors</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
  
  <span class='id focus'>focus</span><span class='period'>.</span><span class='id update_popularity'>update_popularity</span> <span class='kw'>unless</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>||</span> <span class='id focus'>focus</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Board</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun May  1 16:07:46 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.7 (ruby-1.9.2).
</div>

  </body>
</html>